<!DOCTYPE html>
<html lang="{{ lang if lang else 'dv' }}" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>{% block title %}{{ _('title') }}{% endblock %}</title>
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='img/icon.svg') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'Tharujamaanu';
            src: url('https://fonts.hassaanmv.com/fonts/merged-light.woff2') format('woff2'),
                 url('https://fonts.hassaanmv.com/fonts/merged-light.woff') format('woff');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        @font-face {
            font-family: 'Tharujamaanu';
            src: url('https://fonts.hassaanmv.com/fonts/merged-bold.woff2') format('woff2'),
                 url('https://fonts.hassaanmv.com/fonts/merged-bold.woff') format('woff');
            font-weight: bold;
            font-style: normal;
            font-display: swap;
        }
    </style>
    {% block head_extra %}{% endblock %}
</head>

<body>
    <div id="toast-container" class="toast-container"></div>

    <header class="app-header">
        <div class="container header-content">
            <h1 class="app-title">
                <img src="{{ url_for('static', filename='img/icon.svg') }}" alt="Logo" class="app-logo" width="32" height="32">
                {{ _('title') }}
            </h1>
            
            <div class="header-actions">
                <nav class="main-nav" id="main-nav">
                    <ul>
                        <li><a href="{{ url_for('main.index') }}" class="nav-link {% if request.endpoint == 'main.index' %}active{% endif %}">{{ _('nav_home') }}</a></li>
                        <li><a href="{{ url_for('main.compare_ui') }}" class="nav-link {% if request.endpoint == 'main.compare_ui' %}active{% endif %}">{{ _('nav_compare') }}</a></li>
                        <li><a href="{{ url_for('stats.stats') }}" class="nav-link {% if request.endpoint == 'stats.stats' %}active{% endif %}">{{ _('nav_stats') }}</a></li>
                    </ul>
                </nav>

                <div class="controls-group">
                    <button class="btn icon-btn mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle Menu">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                        </svg>
                    </button>

                    <button id="theme-toggle" class="btn icon-btn" aria-label="{{ _('toggle_dark_mode') }}" title="{{ _('toggle_dark_mode') }}">
                        <svg class="theme-icon light-icon" style="display: none;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
                        </svg>
                        <svg class="theme-icon dark-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
                        </svg>
                    </button>

                    {% if user_monthly_cost is defined and username != 'Guest' %}
                    <div class="header-budget" title="{{ _('monthly_cost_label') }}">
                        <span class="budget-value">${{ "%.2f"|format(user_monthly_cost) }}</span>
                        {% if not budget_allowed %}
                        <span class="budget-exceeded">!</span>
                        {% endif %}
                    </div>
                    {% endif %}

                    <div class="user-menu-wrapper">
                        <button id="user-menu-btn" class="btn text-btn user-btn">
                            <span id="current-username">{{ username }}</span>
                             <span class="icon">â–¼</span>
                        </button>
                        <div id="user-menu-dropdown" class="dropdown-menu hidden">
                             <div class="dropdown-content">
                                <label for="username-select" class="dropdown-label">{{ _('select_user') }}</label>
                                <select id="username-select" class="form-select full-width">
                                    <option value="">{{ _('select_user') }}</option>
                                </select>
                                <input type="password" id="user-password" placeholder="{{ _('pin_password') }}" class="form-input full-width mt-2">
                                <button id="login-btn" class="btn primary full-width mt-2">{{ _('login') }}</button>
                             </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="container main-content">
        {% block content %}{% endblock %}
    </main>

    <footer class="app-footer">
        <div class="container">
            <p>&copy; 2025 {{ _('title') }}</p>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    {% block scripts %}{% endblock %}
</body>

</html>
